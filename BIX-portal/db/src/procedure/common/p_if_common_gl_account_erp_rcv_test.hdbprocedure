/**
* gl_account 수신 프로시져
*/

PROCEDURE P_IF_COMMON_GL_ACCOUNT_ERP_RCV_TEST (
	IN VER_NO NVARCHAR(20),
    IN JSONDATA  CLOB                    
)
LANGUAGE SQLSCRIPT SQL SECURITY INVOKER AS
BEGIN
	-- -- 인터페이스 기본정보 변수 선언
	DECLARE V_VER NVARCHAR(20) = VER_NO;
	DECLARE V_FLAG NVARCHAR(10) DEFAULT NULL;

	INSERT INTO COMMON_IF_GL_ACCOUNT_TEST (
		-- 인터페이스 정보
		VER,
		FLAG,
		-- 인터페이스 테이블 컬럼
		GL_ACCOUNT, COMMITMENT_ITEM, DESCRIPTION
	)
	WITH JSON_STRING AS (SELECT :JSONDATA AS INPUT FROM DUMMY)
	SELECT
		-- 인터페이스 정보
		:V_VER AS VER,
		:V_FLAG AS FLAG,
		-- 인터페이스 JSON 데이터 컬럼
		JT.GL_ACCOUNT, JT.COMMITMENT_ITEM, JT.DESCRIPTION
	FROM
		-- I/F API의 JSON PROPERTY 의 KEY값과 IF 테이블 컬럼명 매핑
		JSON_TABLE (JSON_STRING.INPUT, '$.DATA[*]'
		COLUMNS
			(
				GL_ACCOUNT 			NVARCHAR(10)		PATH '$.GLAccount',				--프로젝트 계정코드
				COMMITMENT_ITEM 	NVARCHAR(24)		PATH '$.CommitmentItem',		--중계정
				DESCRIPTION 		NVARCHAR(40)		PATH '$.GLAccountName'			--GL계정 이름
			)
		) AS JT;
END;