<mvc:View controllerName="bix.ai.component.controller.AI"
    displayBlock="true" height="100%"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:tnt="sap.tnt"
    xmlns:form="sap.ui.layout.form"
    xmlns:layout="sap.ui.layout"   
    xmlns:w="sap.ui.integration.widgets" 
    xmlns="sap.m">
    <f:DynamicPage showFooter="true" class="sapUiContentPadding custom-ai-page"> 
        <f:content>
            <Panel height="100%" class="chat-panel-container">
                <content>
                    <form:SimpleForm visible="{ui>/initPage}">
                        <form:content>
                            <VBox class="custom-ai-section-margin-l">
                                <HBox justifyContent="SpaceBetween" alignItems="Center">
                                    <Text text="ì–¸ì œ, ì–´ë””ì„œë‚˜ ë“ ë“ í•œ" class="custom-text-medium custom-text-size13"/>
                                    <Button icon="sap-icon://decline" press="onChatBotExit" class="chat-close-button"/>
                                </HBox>
                                <Text text="AI ìŠ¤íŽ˜ì…œë¦¬ìŠ¤íŠ¸" class="custom-ai-title"/>
                                <layoutData>
                                    <layout:GridData span="XL12 L12 M12 S12"/>
                                </layoutData>
                            </VBox>
                            <VBox class="custom-ai-section-margin-m">
                                <HBox class="custom-ai-section-title custom-ai-section-margin-s">
                                    <HBox width="1.375rem" justifyContent="Center">
                                        <Image src="./resource/icon/ai_icon07.png"/>
                                    </HBox>
                                    <Text text="ìŠ¤íŽ˜ì…œ ë¦¬ìŠ¤íŠ¸" />
                                </HBox>
                                <Text text="ê²½ì˜ì •ë³´ ë¶„ì„ê³¼ ì˜ì‚¬ê²°ì •ì„ ì§€ì›í•˜ëŠ” AI ì „ë¬¸ê°€ìž…ë‹ˆë‹¤." class="custom-text-size13"/>
                                <layoutData>
                                    <layout:GridData span="XL12 L12 M12 S12"/>
                                </layoutData>
                            </VBox>

                            <Carousel
                                height="13rem"
                                showPageIndicator="false"
                                class="custom-ai-tile-carousel">
                                <form:SimpleForm class="custom-ai-tile-container">
                                    <form:layoutData>
                                        <layout:GridData span="XL12 L12 M12 S12"/>
                                    </form:layoutData>
                                    <form:content>
                                        <VBox>
                                            <GenericTile id="initTile" header="ì§ˆì˜í˜•" fieldGroupIds="aiTile" class="tile-blue" press="onAiTilePress">
                                                <TileContent>
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì „ë¬¸ê°€" colorScheme="6"/>
                                                        <Image src="./resource/icon/ai_icon10.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <GenericTile header="ë³´ê³ ì„œ" fieldGroupIds="aiTile" class="tile-navy" press="onAiTilePress">
                                                <TileContent>
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì „ë¬¸ê°€" colorScheme="2"/>
                                                        <Image src="./resource/icon/ai_icon11.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <layoutData>
                                                <layout:GridData span="XL4 L4 M4 S4"/>
                                            </layoutData>
                                        </VBox>
                                        <VBox>
                                            <GenericTile header="ì¦‰ë‹µí˜•" fieldGroupIds="aiTile" class="tile-green" press="onAiTilePress">
                                                <TileContent>
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì „ë¬¸ê°€" colorScheme="8"/>
                                                        <Image src="./resource/icon/ai_icon02.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <GenericTile header="ì‹œê°í™”" fieldGroupIds="aiTile" class="tile-red" press="onAiTilePress" state="Disabled">
                                                <TileContent>
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì¤€ë¹„ì¤‘" colorScheme="2"/>
                                                        <Image src="./resource/icon/ai_icon03.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <layoutData>
                                                <layout:GridData span="XL4 L4 M4 S4"/>
                                            </layoutData>
                                        </VBox>
                                        <VBox>
                                            <GenericTile header="ë„¤ë¹„ê²Œì´í„°" fieldGroupIds="aiTile" class="tile-pink" press="onAiTilePress">
                                                <TileContent>
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì „ë¬¸ê°€" colorScheme="3"/>
                                                        <Image src="./resource/icon/ai_icon04.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <GenericTile header="ì‚¬ìš©ì•ˆë‚´" fieldGroupIds="aiTile" class="tile-purple" press="onAiTilePress" state="Disabled">
                                                <TileContent>
                                                    <!--HBox justifyContent="End"-->
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì¤€ë¹„ì¤‘" colorScheme="6"/>
                                                        <Image src="./resource/icon/ai_icon06.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <layoutData>
                                                <layout:GridData span="XL4 L4 M4 S4"/>
                                            </layoutData>
                                        </VBox>
                                    </form:content>
                                </form:SimpleForm>
                                <!--form:SimpleForm class="custom-ai-tile-container">
                                    <form:layoutData>
                                        <layout:GridData span="XL12 L12 M12 S12"/>
                                    </form:layoutData>
                                    <form:content>
                                        <VBox height="12.875rem" gap="0.5rem">
                                            <GenericTile header="í˜„í™©ë¶„ì„" fieldGroupIds="aiTile" class="tile-yellow" press="onAiTilePress">
                                                <TileContent>
                                                    <HBox justifyContent="SpaceBetween">
                                                        <tnt:InfoLabel text="ì „ë¬¸ê°€" colorScheme="1"/>
                                                        <Image src="./resource/icon/ai_icon05.png"/>
                                                    </HBox>
                                                </TileContent>
                                            </GenericTile>
                                            <layoutData>
                                                <layout:GridData span="XL4 L4 M4 S4"/>
                                            </layoutData>
                                        </VBox>
                                    </form:content>
                                </form:SimpleForm-->
                            </Carousel>

                            <!--VBox>
                                <HBox class="custom-ai-section-title custom-ai-section-margin-m">
                                    <HBox width="1.375rem" justifyContent="Center">
                                        <Image src="./resource/icon/ai_icon08.png"/>
                                    </HBox>
                                    <Text text="{= ${ui>/tileSelectTitle} + 'ì€ ì´ë ‡ê²Œ ì‚¬ìš©í•´ìš”'}" class="custom-ai-section-title"/>
                                </HBox>
                                    <swiper>
                                <Carousel 
                                    class="custom-ai-carousel-container">
                                    <Panel>
                                        <Text text="Digital Innovationë³¸ë¶€ Accountë³„ ë§¤ì¶œ ì‹¤ì ì€?" width="100%" textAlign="Center" class="custom-text-size14 custom-text-medium"/>
                                        <w:Card manifest="../bix/card/plGrid1/manifest.json" width="100%" height="100%" overflow="ShowMore"/>
                                    </Panel>
                                    <Panel>
                                        <HBox gap="10px">
                                            <tnt:InfoLabel text="ì§ˆì˜í˜•" />
                                            <Text text="ìš”ì¦˜ ì´ ì§ˆë¬¸ì„ ë§Žì´í•´ìš”" class="custom-text-size14 custom-text-medium"/>
                                        </HBox>
                                        <VBox gap="10px">
                                            <Button width="100%" text="Digital Innovationë³¸ë¶€ Accountë³„ ë§¤ì¶œ ì‹¤ì ì€?" iconFirst="false" icon="sap-icon://navigation-right-arrow" class="custom-text-size13 custom-text-medium"/>
                                            <Button width="100%" text="PMOë³¸ë¶€ Accountë³„ ë§¤ì¶œ ì‹¤ì ì€?" iconFirst="false" icon="sap-icon://navigation-right-arrow" class="custom-text-size13 custom-text-medium"/>
                                            <Button width="100%" text="ICT ì‚¬ì—…ë³¸ë¶€ Accountë³„ ë§¤ì¶œ ì‹¤ì ì€?" iconFirst="false" icon="sap-icon://navigation-right-arrow" class="custom-text-size13 custom-text-medium"/>
                                        </VBox>
                                    </Panel>
                                </Carousel>
                                <layoutData>
                                    <layout:GridData span="XL12 L12 M12 S12"/>
                                </layoutData>
                            </VBox-->
                        </form:content>
                    </form:SimpleForm>
                    
                    <!-- ê°œì„ ëœ ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ (ì„¸ë¡œ í¬ê¸° ìµœëŒ€í™”) -->
                    <VBox visible="{= !${chat>/showWelcome}}" class="chat-main-container">
                        <!-- ì±„íŒ… í—¤ë” -->
                        <HBox class="chat-header">
                            <HBox alignItems="Center" class="chat-header-content">
                                <core:Icon src="sap-icon://ai" size="1.5rem" color="red" class="chat-header-icon"/>
                                <Title text="AI ìŠ¤íŽ˜ì…œë¦¬ìŠ¤íŠ¸" class="chat-header-title"/>
                            </HBox>
                            <HBox class="chat-header-action">
                                <!--Button 
                                    icon="sap-icon://add"
                                    press="onChatStart"
                                    class="chat-new-button"
                                    text="ìƒˆ ëŒ€í™”"
                                    tooltip="ìƒˆ ëŒ€í™”"/-->
                                <Button 
                                    icon="sap-icon://decline"
                                    press="onToggleChat"
                                    class="chat-close-button"
                                    tooltip="ëŒ€í™”ì°½ ë‹«ê¸°"/>
                            </HBox>
                        </HBox>
                        
                        <!-- ì±„íŒ… ë©”ì‹œì§€ ìŠ¤í¬ë¡¤ ì˜ì—­ (ë†’ì´ ìµœëŒ€í™”) -->
                        <ScrollContainer 
                            id="chatContainer"
                            height="calc(100vh - 280px)"
                            vertical="true" 
                            class="chat-messages-container">
                            <VBox class="chat-messages-wrapper">
                                <!-- ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ -->
                                <List items="{chat>/messages}" showSeparators="None" class="chat-message-list">
                                    <CustomListItem class="chat-message-item">
                                        <VBox width="100%">
                                            <!-- ì‚¬ìš©ìž ë©”ì‹œì§€ -->
                                            <HBox visible="{= ${chat>type} === 'user'}" 
                                                  justifyContent="Start" 
                                                  class="user-message-row">
                                                <VBox class="user-message-bubble">
                                                    <Text text="{chat>content}" class="user-message-text"/>
                                                    <Text text="{chat>displayTime}" class="message-time user-time"/>
                                                </VBox>
                                            </HBox>
                                            
                                            <!-- AI ë©”ì‹œì§€ -->
                                            <HBox visible="{= ${chat>type} === 'ai'}" 
                                                class="ai-message-row">
                                                <HBox class="ai-message-wrapper">
                                                    <!-- AI ë©”ì‹œì§€ ë‚´ìš© -->
                                                    <VBox class="ai-message-content">
                                                        <!-- ì„ íƒëœ ì—ì´ì „íŠ¸ í‘œì‹œ (ì´ë¦„ ë§¤í•‘ ì ìš©) -->
                                                        <HBox visible="{chat>hasAgent}" class="ai-agent-badge-container">
                                                            <HBox class="{path: 'chat>selectedAgent', formatter: '.formatAgentBadgeClass'}" alignItems="Center">
                                                                <Image src="{path: 'chat>selectedAgent', formatter: '.formatAgentIcon'}" 
                                                                        class="ai-agent-badge-icon"/>
                                                                <Text text="{path: 'chat>selectedAgent', formatter: '.formatAgentName'}" 
                                                                    class="ai-agent-badge-text"/>
                                                                <Text text="{chat>displayTime}" class="message-time ai-time"/>
                                                            </HBox>
                                                        </HBox>
                                                        
                                                        <!-- ë©”ì‹œì§€ ë²„ë¸” -->
                                                        <VBox class="ai-message-bubble">
                                                            <!-- ë©”ì¸ í…ìŠ¤íŠ¸ ì‘ë‹µ -->
                                                            <core:HTML content="{chat>content}" class="ai-message-text"/>
                                                            
                                                            <!-- *** ì—¬ê¸°ì— ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ ì„¹ì…˜ ì¶”ê°€ *** -->
                                                            <VBox visible="{chat>hasNavigation}" class="ai-navigation-section">
                                                                <!-- 0ê°œ ë©”ë‰´: ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì•ˆë‚´ -->
                                                                <VBox visible="{= ${chat>navigationData/type} === 'no_menu'}" 
                                                                    class="navigation-no-menu">
                                                                    <Text class="navigation-text navigation-message"/>
                                                                    <Button text="ðŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™" 
                                                                            press="onMainNavigationPress" 
                                                                            type="Emphasized"
                                                                            class="navigation-button-main"/>
                                                                </VBox>

                                                                <!-- 2ê°œ ì´ìƒ ë©”ë‰´: ì„ íƒ ê°€ëŠ¥í•œ ë§í¬ë“¤ -->
                                                                <VBox visible="{= ${chat>navigationData/type} === 'multiple_menus'}" 
                                                                    class="navigation-multiple-menus">
                                                                    <Text class="navigation-title navigation-message"/>
                                                                    <VBox class="navigation-buttons-container">
                                                                        <List items="{chat>navigationData/menus}" 
                                                                            mode="None" 
                                                                            showSeparators="None"
                                                                            class="navigation-menu-list">
                                                                            <CustomListItem class="navigation-menu-item">
                                                                                <Button text="{= 'ðŸ”— ' + ${chat>name}}"
                                                                                        press="onMenuNavigationPress" 
                                                                                        type="Transparent"
                                                                                        width="100%"
                                                                                        class="navigation-button-menu"/>
                                                                            </CustomListItem>
                                                                        </List>
                                                                    </VBox>
                                                                </VBox>
                                                            </VBox>

                                                            <!-- ë³´ê³ ì„  ì—ì´ì „íŠ¸ ì˜ì—­ -->
                                                            <VBox visible="{chat>hasReport}" class="ai-report-section">
                                                                <!-- ë³´ê³ ì„œ ì°¾ê¸° ì‹¤íŒ¨: ì›”ë§ˆê° ë³´ê³ ì„œë¡œ ì•ˆë‚´ -->
                                                                <VBox visible="{= ${chat>reportData/type} === 'no_report'}" 
                                                                    class="no-report">
                                                                    <Button text="ðŸ“Š ì›”ë§ˆê° ì „ì‚¬ ë³´ê³ ì„œ ë³´ê¸°" 
                                                                            press="onDefaultReportPress" 
                                                                            type="Emphasized"
                                                                            class="report-button-main"/>
                                                                </VBox>

                                                                <!-- 2ê°œ ì´ìƒ ë³´ê³ ì„œ: ì„ íƒ ê°€ëŠ¥í•œ ë§í¬ë“¤ -->
                                                                <VBox visible="{= ${chat>reportData/type} === 'multiple_reports'}" 
                                                                    class="multiple-reports">
                                                                    <VBox class="report-buttons-container">
                                                                        <List items="{chat>reportData/reports}" 
                                                                            mode="None" 
                                                                            showSeparators="None"
                                                                            class="navigation-menu-list">
                                                                            <CustomListItem class="navigation-menu-item">
                                                                                <Button text="{= 'ðŸ“Š ' + ${chat>name}}" 
                                                                                        press="onReportOpenPress" 
                                                                                        type="Transparent"
                                                                                        width="100%"
                                                                                        class="report-button"/>
                                                                            </CustomListItem>
                                                                        </List>
                                                                    </VBox>
                                                                </VBox>

                                                                <!-- ë³´ê³ ì„œ ì²˜ë¦¬ ì˜¤ë¥˜ -->
                                                                <VBox visible="{= ${chat>reportData/type} === 'error'}" 
                                                                    class="no-report">
                                                                    <Text text="{chat>reportData/message}" class="report-text report-message"/>
                                                                </VBox>
                                                            </VBox>
                                                            
                                                            <!-- ê¸°ì¡´ í…Œì´ë¸” ë°ì´í„° -->
                                                            <Table visible="{chat>hasTableData}" 
                                                                items="{chat>tableData}" 
                                                                class="ai-data-table">
                                                                <columns>
                                                                    <Column width="35%"><Text text="ë¶€ì„œëª…" class="table-header"/></Column>
                                                                    <Column width="25%"><Text text="ìœ í˜•" class="table-header"/></Column>
                                                                    <Column width="40%"><Text text="ê¸ˆì•¡" class="table-header"/></Column>
                                                                </columns>
                                                                <items>
                                                                    <ColumnListItem class="table-row">
                                                                        <Text text="{chat>div_name}" class="table-cell"/>
                                                                        <Text text="{chat>type}" class="table-cell"/>
                                                                        <Text text="{path: 'chat>total_data', formatter: '.formatNumber'}" class="table-cell table-number"/>
                                                                    </ColumnListItem>
                                                                </items>
                                                            </Table>
                                                            
                                                            <!-- <Text text="{chat>displayTime}" class="message-time ai-time"/> -->
                                                        </VBox>
                                                    </VBox>
                                                </HBox>
                                            </HBox>
                                        </VBox>
                                    </CustomListItem>
                                </List>
                                
                                <!-- ë¡œë”© í‘œì‹œ -->
                                <HBox visible="{chat>/isLoading}" class="ai-message-row">
                                    <HBox class="ai-message-wrapper">
                                        <!-- AI ì•„ë°”íƒ€ (ë¡œë”© ì¤‘ì¼ ë•ŒëŠ” ê¸°ë³¸ ë¡œë´‡ ì•„ì´ì½˜) -->
                                        <VBox class="ai-avatar-container">
                                            <core:Icon src="sap-icon://robot" 
                                                     size="2rem" 
                                                     color="white" 
                                                     class="ai-avatar-icon loading-avatar"/>
                                        </VBox>
                                        
                                        <!-- ë¡œë”© ë©”ì‹œì§€ -->
                                        <VBox class="ai-message-content">
                                            <VBox class="ai-message-bubble loading-bubble">
                                                <HBox alignItems="Center" class="loading-content">
                                                    <BusyIndicator size="1.2rem" class="loading-spinner"/>
                                                    <Text text="ì‘ë‹µì„ ìƒì„±í•˜ê³  ìžˆìŠµë‹ˆë‹¤..." class="loading-text"/>
                                                </HBox>
                                            </VBox>
                                        </VBox>
                                    </HBox>
                                </HBox>
                            </VBox>
                        </ScrollContainer>
                    </VBox>
                </content>            
            </Panel>
        </f:content>
        <f:footer>
            <Toolbar class="custom-ai-toolbar">
                <ToolbarSpacer />
                    <!-- SearchFieldì—ì„œ ë²„íŠ¼ ìˆ¨ê¸°ê¸° -->
                    <SearchField 
                        id="SearchFieldId"
                        placeholder="ê¶ê¸ˆí•œ ì‚¬í•­ì„ ìž…ë ¥í•´ ì£¼ì„¸ìš”"
                        class="custom-ai-searchField"
                        showSearchButton="false"
                        search="onSearch"
                        enabled="{= !${chat>/isLoading}}">
                    </SearchField>
                    <!-- ì „ì†¡ ë²„íŠ¼ -->
                    <Button 
                        icon="sap-icon://paper-plane"
                        press="onSearch"
                        visible="{= !${chat>/isLoading}}"
                        enabled="{= !${chat>/isLoading}}"
                        type="Transparent"
                        class="custom-send-button"
                        tooltip="ì „ì†¡"/>
                    <!-- ì¤‘ì§€ ë²„íŠ¼ -->
                    <Button 
                        icon="sap-icon://stop"
                        press="onStopChat" 
                        visible="{chat>/isLoading}" 
                        type="Transparent"
                        class="custom-stop-button"
                        tooltip="ëŒ€í™” ì¤‘ì§€"/>
                <ToolbarSpacer /> 
            </Toolbar>
        </f:footer>
    </f:DynamicPage>
</mvc:View>